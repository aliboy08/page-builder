(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function e(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(i){if(i.ep)return;i.ep=!0;const r=e(i);fetch(i.href,r)}})();function c(s="",t,e="",n="append"){const i=document.createElement("div");return s[0]==="#"?i.id=s:i.className=s,e&&(i.textContent=e),t&&t[n](i),i}function _(s,t=!1,e=document){return typeof s=="string"?t?e.querySelectorAll(s):e.querySelector(s):s}function m(s,t={},e=document){const n=new Event(s);n.data=t,e.dispatchEvent(n)}function g(s=10){const t="1234567890abcdefghijklmnopqrstuvwxyz";let e="";for(let n=1;n<=s;n++){const i=Math.floor(Math.random()*t.length);e+=t[i]}return e}class d{constructor(t){this.action_keys=t,this.actions={},this.filters={},t.forEach(e=>{this.actions[e]=[]})}add(t,e,n=10){this.actions[t]&&typeof e=="function"&&(typeof this.actions[t][n]>"u"&&(this.actions[t][n]=[]),this.actions[t][n].push(e))}do(t,e){this.actions[t]&&this.actions[t].forEach(n=>{n.forEach(i=>i(e))})}add_action(t){this.actions[t]=[]}add_filter(t,e,n=10){this.filters[t]||(this.filters[t]={}),this.filters[t][n]||(this.filters[t][n]=[]),this.filters[t][n].push(e)}apply_filters(t,e,n){if(!this.filters[t])return e;for(const i in this.filters[t])for(const r of this.filters[t][i])e=r(e,n);return e}clear(t){if(t){if(!this.actions[action_key])return;this.actions[action_key]=[]}else this.action_keys.forEach(e=>{this.actions[e]=[]})}}const f=new d(["init","after_init","select_element"]);class y{constructor(){this.selected=null,this.selected_trigger=null,this.throttling=!1,document.addEventListener("element_after_render",({data:t})=>{this.init(t.html)})}init(t,e={}){t.addEventListener("click",n=>{this.select(t,e)})}select(t,e={}){if(this.throttle())return;this.unselect_previous();let n=t;e.target&&(n=e.target,t.dataset.state="selected",this.selected_trigger=t),this.selected=n,n.dataset.state="selected",n.element&&f.do("select_element",n.element)}unselect(t){t.dataset.state=""}unselect_previous(){this.selected&&this.unselect(this.selected),this.selected_trigger&&(this.selected_trigger.dataset.state="",this.selected_trigger=null)}throttle(){return this.throttling?!0:(this.throttling=!0,setTimeout(()=>{this.throttling=!1},50),!1)}}class v{constructor(t){document.addEventListener("keydown",e=>{if(e.key!=="Delete")return;const n=t.selected;n.element&&n.id!=="page_content_body"&&(n.element.remove(),t.selected=null)})}}class E{constructor(t){this.builder=t,this.button=this.init_button(),t.container.parentElement.prepend(this.button)}init_button(){const t=document.createElement("button");return t.className="save_button",t.textContent="Save",t.addEventListener("click",()=>{this.save(),t.textContent="Saved",t.dataset.state="saved",setTimeout(()=>{t.textContent="Save",t.dataset.state=""},2e3)}),t}save(){const t=this.get_data();localStorage.setItem("page_builder_data",JSON.stringify(t))}get_data(){const t=[],e=(i,r)=>{i.el_children.forEach(o=>{const l=o.get_data();n(o,l),r.push(l)})},n=(i,r)=>{i?.el_children?.length&&(r.children=[],e(i,r.children))};return e(this.builder.content,t),t}}class b{constructor(t){this.builder=t}load(t){t=JSON.parse(t);const e=this.builder.manager,n=(r,o)=>{r.forEach(l=>{const a=e.elements[l.type].init,u=new a(l.id);u.data=l.data;const p=u.render(o);i(l,p)})},i=(r,o)=>{r.children?.length&&n(r.children,o)};n(t,this.builder.content)}}class x{constructor(t="#page_content"){this.container=_(t),this.selector=new y,new v(this.selector),new E(this),this.content_loader=new b(this),this.init_content()}init_content(){const t=_("#page_content_body");this.content=t,t.el_children=[],this.selector.selected=t;const e=c("add_zone");t.after(e),this.selector.init(e,{target:t})}init_manager(t){const e=n=>{const i=this.selector.selected;i?.el_children&&n.render(i)};t.hooks.add("select",n=>{e(n)}),this.manager=t}}function L(s,t={}){let e,n,i;const r=()=>{document.removeEventListener("pointerup",r),document.removeEventListener("pointermove",o),typeof t.end=="function"&&t.end()},o=a=>{n=a.pageX,i=n-e,typeof t.update=="function"&&t.update(i)},l=a=>{a.preventDefault(),e=a.pageX,document.addEventListener("pointerup",r),document.addEventListener("pointermove",o),typeof t.start=="function"&&t.start()};s.addEventListener("pointerdown",l)}class w{constructor(t,e){this.el=t,this.args=e,this.hooks=new d(["resize"]),this.init()}init(){const t=c("resize_handle",this.el);let e;L(t,{start:()=>{e=this.el.offsetWidth},update:n=>{this.el.style.width=e+n+"px"},end:()=>{this.hooks.do("resize",this.el.offsetWidth)}})}}class k{constructor(t){this.type=t}get_html(){return this.html=c(`field field_${this.type}`),this.inner_html&&this.html.append(this.inner_html()),this.html}load_value(){}init_element_interface(){}}class S extends k{constructor(t,e){super("text"),this.html=this.get_html(),this.init_element_interface(t,e)}inner_html(){const t=new DocumentFragment,e=document.createElement("input");return e.type="text",t.append(e),this.input=e,t}load_value(t){t[this.key]&&(this.input.value=t[this.key])}init_element_interface(t,e){this.key=t.key,typeof t.on_change=="function"&&this.input.addEventListener("change",()=>{t.on_change(this.input.value)}),this.load_value(e.data)}}const z={text:S};class C{constructor(t){this.control_panel=t,f.add("select_element",e=>{this.load(e)})}load(t){t.settings?.fields&&(this.control_panel.body.innerHTML="",this.render_fields(t))}render_fields(t){t.settings.fields.forEach(e=>{const n=new z[e.type](e,t);this.control_panel.body.append(n.html)})}}class O{constructor(t={}){this.parent_container=t.parent_container,this.init_html(),this.init_resizer(),this.settings_loader=new C(this)}init_html(){this.container=c("#builder_control_panel"),this.container.className="control_panel",this.parent_container.prepend(this.container);const t=c("inner",this.container);this.body=c("body",t)}init_resizer(){const t=new w(this.container),e=n=>{this.parent_container.style.paddingLeft=n+"px"};e(this.container.offsetWidth),t.hooks.add("resize",e)}init_manager(t){t.render_to(this.body)}}class h{constructor(t,e=null){this.type=t,this.id=e||g(),this.data={},this.settings={}}get_html(){const t=c(`element element_${this.type}`);return t.innerHTML=this.inner_html(),t.element=this,t}inner_html(){return""}render(t,e="append"){const n=this.get_html();switch(e){case"append":t.append(n);break;case"after":t.after(n);break;case"before":t.before(n);break;case"prepend":t.prepend(n);break}return this.html=n,this.el_parent=t,t.el_children.push(this),m("element_after_render",{html:n}),n}remove(){const t=this.el_parent.el_children.indexOf(this);this.el_parent.el_children.splice(t,1),this.html.remove()}get_data(){return{id:this.id,type:this.type,data:this.data}}}class T extends h{constructor(t=null){super("container",t),this.el_children=[]}get_html(){const t=c("container");return t.el_children=this.el_children,t.element=this,t}}class M extends h{constructor(t=null){super("heading",t),this.data={text:"Heading Element"},this.settings={fields:[{type:"text",key:"text",label:"Text",on_change:e=>{console.log("element:text_change",e),this.data.text=e,this.html.textContent=e}}]}}inner_html(){const t=this.data;return console.log("inner_html"),`${t.text}`}}class N extends h{constructor(t=null){super("text_editor",t),this.data={text:"Text Editor"}}inner_html(){return`${this.data.text}`}}class H{constructor(t={}){this.elements={container:{name:"Container",init:T},heading:{name:"Heading",init:M},text_editor:{name:"Text Editor",init:N}},this.hooks=new d(["select"]),this.args=t}render_to(t,e={}){e.clear&&(t.innerHTML="");const n=c("elements_manager_list",t);this.create_els().forEach(i=>{n.append(i),this.init_el(i)})}create_els(){const t=[];for(const e in this.elements){const n=this.elements[e],i=c("element");i.classList.add("element_"+e),c("name",i,n.name),i.type=e,t.push(i)}return t}init_el(t){t.addEventListener("click",()=>{const e=new this.elements[t.type].init;this.hooks.do("select",e)})}}function P(){const s=document.querySelector("#page_builder"),t=new H,e=new x("#page_content");e.init_manager(t),new O({parent_container:s}).init_manager(t);const i=localStorage.getItem("page_builder_data");i&&e.content_loader.load(i)}document.addEventListener("DOMContentLoaded",P);
